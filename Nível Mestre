#include <stdio.h> 
#include <stdlib.h>
#include <string.h>
#include <time.h>    

// Estrutura que representa um território no jogo
typedef struct {
    char nome[30];   // Nome do território
    char cor[10];    // Cor do exército que o controla
    int tropas;      // Quantidade de tropas no território
} Territorio;

// Função que simula um ataque entre dois territórios
void atacar(Territorio *atacante, Territorio *defensor) {
    // Gera números aleatórios entre 1 e 6 para simular os dados de ataque e defesa
    int dadoAtaque = rand() % 6 + 1;
    int dadoDefesa = rand() % 6 + 1;

    // Exibe o resultado dos dados e o combate
    printf("\n%s ataca %s!\n", atacante->nome, defensor->nome);
    printf("Dado atacante: %d | Dado defensor: %d\n", dadoAtaque, dadoDefesa);

    // Caso o atacante tire um valor igual ou maior que o defensor
    if (dadoAtaque >= dadoDefesa) {
        defensor->tropas -= 1; // O defensor perde uma tropa

        // Se o defensor perder todas as tropas, o atacante conquista o território
        if (defensor->tropas <= 0) {
            strcpy(defensor->cor, atacante->cor);  // O território muda de cor 
            defensor->tropas = atacante->tropas / 2; // Metade das tropas do atacante ocupa o novo território
            printf("%s conquistou %s!\n", atacante->nome, defensor->nome);
        }
    } else {
        // Caso o defensor vença, o atacante perde uma tropa
        atacante->tropas -= 1;
        printf("%s perdeu uma tropa.\n", atacante->nome);
    }
}

// Função que atribui uma missão aleatória a um jogado
void atribuirMissao(char *destino, char *missoes[], int totalMissoes) {
    int idx = rand() % totalMissoes;   // Sorteia um índice aleatório
    strcpy(destino, missoes[idx]);     // Copia a missão correspondente para o jogador
}

// Função que exibe o estado atual do mapa - os territórios
void exibirMapa(Territorio *mapa, int n) {
    printf("\nMapa Atual:\n");
    for (int i = 0; i < n; i++) {
        printf("%d: %s | Cor: %s | Tropas: %d\n",
               i + 1, mapa[i].nome, mapa[i].cor, mapa[i].tropas);
    }
}

// Função que libera toda a memória alocada dinamicamente
void liberarMemoria(Territorio *mapa, char **missoes, int numJogadores) {
    free(mapa); // Libera o vetor de territórios
    for (int i = 0; i < numJogadores; i++)
        free(missoes[i]); // Libera as missões individuais
    free(missoes); // Libera o vetor de ponteiros para missões
}

// Função principal - ponto de entrada do programa
int main() {
    srand(time(NULL)); // Inicializa o gerador de números aleatórios com base no tempo atual

    int n, numJogadores = 2;
    printf("Número de territórios: ");
    scanf("%d", &n);  // Lê a quantidade de territórios
    getchar();        // Limpa o buffer de entrada - remove o '\n' deixado pelo scanf

    // Aloca dinamicamente um vetor de territórios
    Territorio *mapa = (Territorio *)calloc(n, sizeof(Territorio));

    // Cadastro dos territórios (nome, cor e número de tropas)
    for (int i = 0; i < n; i++) {
        printf("Território %d nome: ", i + 1);
        fgets(mapa[i].nome, 30, stdin);                         // Lê o nome
        mapa[i].nome[strcspn(mapa[i].nome, "\n")] = '\0';       // Remove o '\n' final da string

        printf("Cor do exército: ");
        fgets(mapa[i].cor, 10, stdin);
        mapa[i].cor[strcspn(mapa[i].cor, "\n")] = '\0';         // Remove o '\n' final da string

        printf("Tropas: ");
        scanf("%d", &mapa[i].tropas);                           // Lê o número de tropas
        getchar();                                               // Limpa o buffer de entrada
    }

    // Definição da lista de missões possíveis
    char *listaMissoes[] = {
        "Destruir o exército Verde",
        "Conquistar 3 territórios",
        "Elimine todas as tropas Vermelhas",
        "Conquistar territórios seguidos",
        "Manter mais de 5 tropas em um território"
    };

    // Atribui uma missão aleatória para cada jogador
    char **missoesJogadores = (char **)malloc(numJogadores * sizeof(char *));
    for (int i = 0; i < numJogadores; i++) {
        missoesJogadores[i] = (char *)malloc(100 * sizeof(char)); // Reserva espaço para a missão
        atribuirMissao(missoesJogadores[i], listaMissoes, 5);     // Atribui missão aleatória
        printf("Missão do Jogador %d: %s\n", i + 1, missoesJogadores[i]);
    }

    // Loop principal do jogo - menu
    int opcao;
    do {
        exibirMapa(mapa, n); // Mostra o estado atual do mapa

        // Exibe as opções do menu
        printf("\nMenu:\n");
        printf("1 - Atacar\n");
        printf("2 - Verificar Missão\n");
        printf("0 - Sair\n");
        printf("Opção: ");
        scanf("%d", &opcao);
        getchar();

        // Opção 1: Realizar ataque
        if (opcao == 1) {
            int atk, def;
            printf("Escolha atacante: ");
            scanf("%d", &atk);
            printf("Escolha defensor: ");
            scanf("%d", &def);
            getchar();

            // Chama a função de ataque passando ponteiros dos territórios escolhidos
            atacar(&mapa[atk - 1], &mapa[def - 1]);
        }

        // Opção 2: Mostrar as missões dos jogadores
        else if (opcao == 2) {
            printf("Verificação de missões (exemplo simplificado):\n");
            for (int i = 0; i < numJogadores; i++)
                printf("Jogador %d missão: %s\n", i + 1, missoesJogadores[i]);
        }

    } while (opcao != 0); // Continua até o usuário escolher 0 - Sair

    // Libera a memória alocada antes de encerrar o programa
    liberarMemoria(mapa, missoesJogadores, numJogadores);

    return 0; // Fim do programa
}
